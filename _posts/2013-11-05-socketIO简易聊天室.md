---
layout: post
title: socketIO简易聊天室
---

{{ page.title }}
================

安装
---------------------------
首先安装 mongoose
	$ npm install socket.io

案例
--------------

### server端

	var server = http.createServer(app).listen(app.get('port'), function(){
	  console.log('Express server listening on port ' + app.get('port'));
	});

	var io = require('socket.io').listen(server);

	io.sockets.on('connection', function (socket) {
	    socket.emit('message', {
		message: '哈哈 很好 成功了！！'
	    });
	    
	    socket.on('send', function (data) {
		io.sockets.emit('message', data);
	    });
	});

### web端

	<input id="username" type="text" />
	    <textarea id="field"></textarea>
	    
	    <button id="btn">发送</button>
	    <div id="content"></div>
	    
	    <script src="/socket.io/socket.io.js"></script>
	    
	    <script>
		
		
		
		var socket = io.connect('http://localhost:3000'),
		    messages = [],
		
		    content = $('#content'),
		    field = $('#field'),
		    username = $('#username'),  
		
		    btn = $('#btn');
		
		socket.on('message', function (data) {
		    
		    if (data.message) {
			messages.push(data);
			var html = '',
			    i,
			    len = messages.length,
			    str;
			    
			   
			    
			for (i = 0; i < len; i += 1) {
			    str = '';
			     if (messages[i].username) {
				str += messages[i].message + messages[i].username;
			    }
			    
			    else {
				str += messages[i].message;
			    }
			    html += str + '<br />';
			}
			
			content.html(html);
		    }
		    
		    else {
			console.log('出错了！！！');
		    }
		    
		});
		
		btn.click(function () {
		    
		    if (username.val() == '') {
			alert('姓名不能为空！！！');
		    }
		    socket.emit('send', {
			message: field.val(),
			username: username.val()
		    });
		});
		
		
		
		
		
		
	    </script>