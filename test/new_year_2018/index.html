<!DOCTYPE html>
<html>
   <head>
       <meta charset="utf-8" />
       <meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport">
       <title></title>
       <style>
           * {
               margin: 0;
               padding: 0;
           }
            .snow {
              position: absolute;
              top: 0;
              left: 0;
              z-index: 20;
              opacity: .8;
            }
            .load {
                width: 100%;
                position:absolute;
                top: 50%; 
                text-align: center;
                font-size: 40px;
            }
            
            .page-btn {
               position: fixed;
               width: 100%;
               z-index: 999;
               text-align: center;
           }
           
           @-webkit-keyframes arrowUpDown {
                0% {bottom: 10px;}
                100% {bottom: 20px;}
            }
            
            .page-btn {
                -webkit-animation-name: arrowUpDown;
                -webkit-animation-duration: .4s;
                -webkit-animation-iteration-count: infinite;
                -webkit-animation-direction: alternate;
                -webkit-animation-timing-function: linear;
            }
            
            #music {
                position: fixed;
                right: 50px;
                top: 50px;
                width: 56px;
                height: 56px;
                background: url(images/music_control_1.png) no-repeat 1px 1px;
                z-index: 99;
                opacity: 0;
            }
    
            #music.on {
                background: url(images/music_control_2.png) no-repeat 1px 1px;
            }
            
            body {
                overflow: hidden;
                color: #333;
                background: #e92018;
            }
            .wrap {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                -webkit-transition: all 0.3s linear;
                -webkit-backface-visibility: hidden;
            }
            
            section {
                overflow: hidden;
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                -webkit-transform: translate(0px, 0px);
                -webkit-transition: -webkit-transform 0.4s;
            }
            .down {
                -webkit-transform: translate(0px, 100%);
            }
            .up {
                -webkit-transform: translate(0px, -100%);
            }
            section img {
                display: block;
            }
            .typed {
                position: absolute;
                top: 195px;
                right: 0;
                width: 442px;
                height: 230px;
                background: url(./images/text-bg.png) no-repeat;
                background-size: cover;
                font-size: 24px;
                box-sizing: border-box;
                padding: 40px;
                line-height: 1.5;
                
            }
            .typed img {
                display: inline;
                vertical-align: middle;
            }
            .typed1 {
                width: 465px;
                height: 264px;
                background: url(./images/text-bg2.png) no-repeat;
                background-size: cover;
            }
            .typed-cursor {
                display: none;
            }
            
            /*
             * p1
             */
            
            .p1-r {
                position: absolute;
                left: 0;
                top: 100%;
                transition: 1s;
            }
            .p1-b {
                position: relative;
                z-index: 1;
            }
            .show .p1-r {
                top: 0;
            }
            
            /*
             * p2
             */
            
            .section2 .typed {
                top: 390px;
                padding: 54px;
            }
            .section2 .p2-r {
                position: absolute;
                left: -100%;
                top: 0;
                transition: 1s;
            }
            .show .p2-r {
                left: 0;
            }
            
            /*
             * p3
             */
            
            .section3 .typed1 {
                top: 50px;
                width: 538px;
                height: 316px;
                padding: 81px 52px;
            }
            .section3 .p3-r {
                position: absolute;
                top: -30px;
                left: 0;
                animation: bounce-up 1s linear infinite;
            }
            @keyframes bounce-up {
                25% {transform: translateY(10px);}
                50%, 100% {transform: translateY(0);}
                75% {transform: translateY(-10px);}
            }
            
            /*
             * p4
             */
            
            .section4 .p4-r {
                position: absolute;
                left: 170px;
                top: 20px;
                width: 90px;
                height: 90px;
                border-radius: 50%;
                overflow: hidden;
                background: #c1132a;
            }
            .section4 .typed {
                background: none;
                top: 10px;
                left: 0;
                right: auto;
                width: 72%;
                font-size: 24px;
                line-height: 2;
                color: #000;
            }
            .section4 .p4-h {
                position: absolute;
                left: 0;
                top: 0;
                animation: bounce-left 1s linear infinite;
                transform-origin: 213px 639px;
            }
            @keyframes bounce-left {
                25% {transform: rotate(10deg);}
                50%, 100% {transform: rotate(0);}
                75% {transform: rotate(-10deg);}
            }
            .link {
                position: fixed;
                bottom: 90px;
                width: 100%;
                line-height: 50px;
                font-size: 24px;
                text-align: center;
                padding: 40px;
                box-sizing: border-box;
                z-index: 999;
            }
            .link span {
                color: #5b2705;
                text-decoration: none;
                background:#fff;
                display: block;
                animation: toggle-show 1s infinite ease-in-out; 
            }
            @keyframes toggle-show {
                0% {opacity: 0}
                100% {opacity: 1}
            }
            .p4-y1 {
                position: absolute;
                left: 470px;
                top: 180px;
                 animation: scale 1s linear infinite;
            }
            .p4-y2 {
                position: absolute;
                left: 418px;
                top: 620px;
                width: 90px;
                animation: scale 1s linear  infinite ;
                animation-delay: .5s;
            }
            @keyframes scale {
                0% {transform: scale(0);}
                100% {transform: rotate(2);}
            }
            .mask img {
                width: 80%;
            }
            .mask {
                display: none;
                position: fixed;
                left: 0;
                top: 0;
                bottom: 0;
                right: 0;
                background: rgba(0, 0, 0, .5);
                z-index: 1111;
            }
            .mask div {
                display: flex;
                align-items: center;
                justify-content: center;
                width： 100%;
                height: 100%;
            }
            .share div img {
                width: 50%;
            }
            .share div {
                align-items: flex-start;
                justify-content: flex-end;
            }
            .typed strong {
                font-size: 26px;
            }
            
       </style>
       <script>
            function GetQueryString(name) {
                var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
                var r = decodeURI(window.location.search.substr(1)).match(reg);
                if (r != null)return unescape(r[2]);
                return null;
            }
            
            var customer = GetQueryString('customer');
            var customerJob = GetQueryString('customerJob');
            var username = GetQueryString('username');
            
            var config = [
                '尊敬的<strong>' + customer + customerJob + '</strong><br/>过年好!<br/>新的一年，新时代，让我们重新认识一下吧<img src="./images/smile.png"/>',
                '曾经，我是那村里的二狗子，每天无所事事，只想吃饭睡觉。直到我遇见您……',
                '在您如春风般的温暖下，如夏日般的照耀下，现在，我是团队的顶梁柱，业绩蹭蹭地往上涨，隔壁村的女大学生刘小花也看上了我，眼看着就要成为了人生赢家！',
                '<strong>' + username + '</strong>在这里给您拜年啦<br/>我的感恩化作深深的祝福：<br/>祝您狗年大吉事事顺，<br/>大展宏图日日新，<br/>全家团圆人人康。<br/><br/>2018, 我会继续努力的！'
            ];
       </script>
       <script type="text/javascript">
            function viewport(){ var phoneWidth = parseInt(window.screen.width); var phoneScale = phoneWidth / 640; var ua = navigator.userAgent; if (/Android (\d+\.\d+)/.test(ua)) { var version = parseFloat(RegExp.$1); if (ua.toLowerCase().indexOf("qq") > -1) { document.write('<meta name="viewport" content="width=640, minimum-scale = ' + phoneScale + ', maximum-scale = ' + phoneScale + ', target-densitydpi=320">'); return; } if (version > 2.3) { document.write('<meta name="viewport" content="width=640, minimum-scale = ' + phoneScale + ', maximum-scale = ' + phoneScale + ', target-densitydpi=device-dpi">'); } else { document.write('<meta name="viewport" content="width=640, target-densitydpi=device-dpi">'); } } else { document.write('<meta name="viewport" content="width=640, user-scalable=no, target-densitydpi=device-dpi">'); } }  viewport();
        </script>
   </head>
   <body>
       
       <div class="load">
           正在加载中...
       </div>
       
       <div class="all" style="display: none;">
           <div class="page-btn"><img style="width: 50px;" src="images/arrow.png" /></div>
           <div id="music" class="on" style="opacity: 1;"></div>
           <audio id="audio_music" src="images/music1.mp3" autoplay loop></audio>
           <canvas class="snow" id="snow" width="100%" height="100%"></canvas>
           <div class="wrap">
               <section class="section1">
                   <p class="typed" data-index="0">
                   </p>
                   <img src="./images/m/p1-top.jpg" style="margin-bottom: -2px;"/>
                   <img class="p1-b" src="./images/m/p1-bottom.jpg"/>
                   <img class="p1-r" src="./images/m/p1-r.png"/>
               </section>
               <section class="section2 down">
                   <p class="typed"  data-index="1">
                   </p>
                   <img src="./images/m/p2-bg.jpg"/>
                   <img class="p2-r" src="./images/m/p2.png"/>
                   
               </section>
               <section class="section3 down">
                   <p class="typed typed1"  data-index="2">
                   </p>
                   <img src="./images/m/p3-bg.jpg"/>
                   <img class="p3-r" src="./images/p3-r.png"/>
               </section>
               <section class="section4 down">
                   <p class="typed typed2" style="color:#762523"  data-index="3">
                   </p>
                   <img src="./images/m/p4.jpg"/>
                   <img class="p4-h" src="./images/m/p4.png"/>
                   <img class="p4-y1" src="./images/p4-y.png"/>
                   <img class="p4-y2" src="./images/p4-y.png"/>
               </section>
               
           </div>
           <div class="link"><span>点击这里生成自己的专属拜年贺卡</span></div>
           <div class="mask code">
               <div><img src="images/code.jpg"/></div>
           </div>
           <div class="mask share">
               <div><img src="images/share1.png"/></div>
           </div>
       </div>
       <script src="scripts/jquery.js"></script>
        
        
        <script> 
        var log = '';
        
        
        (function () {
            var pics = [
                "http://h5.we-going.com/images/text-bg.png",
                "http://h5.we-going.com/images/text-bg2.png",
                "http://h5.we-going.com/images/m/p2-bg.jpg",
                "http://h5.we-going.com/images/m/p2.png",
                "http://h5.we-going.com/images/m/p3-bg.jpg",
                "http://h5.we-going.com/images/p3-r.png",
                "http://h5.we-going.com/images/m/p4.png",
                "http://h5.we-going.com/images/m/p4.jpg",
            ];
            var index = 0;
            var len = pics.length;
            
            var progress = function (w) {
                $('.loading').animate({width: w}, 100, 'linear', function () {
                    $('.loading-text').text(w);
                });
            };
            
            var loaded = function () {
                 $('.all').show();
                 $('.load').hide();
                 
                 
                 makeSnow(canvas);
                 page1();
            };
            
            var load = function () {
                var img = new Image();
                img.src = pics[index];
                img.onload = function () {
                    progress(Math.floor((index + 1) / len * 100) + '%');
                    index += 1;
                    if (index < len) {
                        load();
                    }
                    else {
                        loaded();
                    }
                };
            };
            
            var init = function () {
                if (len > 0) {
                    load();
                }
                else {
                    progress('100%');
                }
            };
            
            init();

        })();
       </script>

       <script>
           
           var canvas = document.getElementById('snow');
    
    function makeSnow(el) {
        var ctx = el.getContext('2d');
        var width = 0;
        var height = 0;
        var particles = [];
        
        var Particle = function() {
            this.x = this.y = this.dx = this.dy = 0;
            this.reset();
        }
        
        Particle.prototype.reset = function() {
            this.y = Math.random() * height;
            this.x = Math.random() * width;
            this.dx = (Math.random() * 1) - 0.5;
            this.dy = (Math.random() * 0.5) + 0.5;
        }
        
        function createParticles(count) {
            if (count != particles.length) {
                particles = [];
                for (var i = 0; i < count; i++) {
                    particles.push(new Particle());
                }
            }
        }
                
        function onResize() {
            width = window.innerWidth;
            height = window.innerHeight;
            el.width = width;
            el.height = height;
            
            createParticles((width * height) / 10000);
        }
        
        function updateParticles() {
            ctx.clearRect(0, 0, width, height);
            ctx.fillStyle = '#f6f9fa';
            
            particles.forEach(function(particle) {
                particle.y += particle.dy;
                particle.x += particle.dx;
                
                if (particle.y > height) {
                    particle.y = 0;
                }
                
                if (particle.x > width) {
                    particle.reset();
                    particle.y = 0;
                }
                
                ctx.beginPath();
                ctx.arc(particle.x, particle.y, 5, 0, Math.PI * 2, false);
                ctx.fill();
            });
            
            window.requestAnimationFrame(updateParticles);
        }
        
        onResize();
        updateParticles();
    }
    
       </script>
       
       <script>
          
        var page1 = function () {

           /*
            * 翻页
            */
           var yStart, yEnd;
           var index = 0;
           var allNum = $('section').length;
           var isAnimate = false;
           var isModal = false;
           
           var pageHeight = $(window).height();
           $('section').height(pageHeight);
           
           $(".section1").addClass('show');
           var typed = $(".typed");
           typed.typewriter();
           
           var setPage = function (dir,page,current) {
                isAnimate = true;
                
                $('section').removeClass('show');
                $('.section'+(current+1)).addClass('show');
                
                var typed = $(".typed");
                typed.typewriter();
                
                if (current === allNum - 1) {
                    $('.page-btn').hide();
                } else {
                    $('.page-btn').show();
                }
                
                
                if (current > 1) {
                    $('.snow').hide();
                } else {
                    $('.snow').show();
                }
               
                
                if(dir === 1){
                    $(".section"+(page+1)).removeClass('up');
                    $(".section"+(page+2)).addClass('down');
                    
                }
                else{
                    $(".section"+page).addClass('up');
                    $(".section"+(page+1)).removeClass('down');
                }
               
                // 翻页
                setTimeout(function(){
                    if (isAnimate) {
                        isAnimate = false;
                    }
                },750);
            };
            
            var bindTouchPageUp = function(){
            
                $(document).bind("touchstart", function(e){
                    var touch = e.originalEvent.touches[0];
                    yStart = touch.pageY;
                });
                $(document).bind("touchmove", function(e){
                    event.preventDefault();
                    var touch = e.originalEvent.touches[0];
                    yEnd = touch.pageY;
                    if (isAnimate || isModal) 
                        return false;
                    if (yEnd - 100 > yStart & yEnd > yStart) { //down
                        if (index === 0)
                            return false;
                        setPage(1, --index, index);
                    }
                    else 
                        if (yEnd + 100 < yStart & yEnd < yStart) { //up
                            if (index === (allNum - 1)) 
                                return false;
                            setPage(0, ++index, index);
                        }
                });
            };

           var init = function () {
               bindTouchPageUp();
           };

           init();
        };
       </script>
       
      <script>
         $.fn.typewriter = function() {
             
            this.each(function() {
                var $ele = $(this);
                var str = config[$ele.data('index')];
                
                $ele.html('');
                clearInterval($ele.data('timer'));
                
                var progress = 0;
                $ele.data(
                    'timer',
                    setInterval(function() {
                        var current = str.substr(progress, 1);
                        if (current == '<') {
                            progress = str.indexOf('>', progress) + 1;
                        } else {
                            progress++;
                        }
                        $ele.html(str.substring(0, progress) + (progress & 1 ? '' : ''));
                        if (progress >= str.length) {
                            clearInterval($ele.data('timer'));
                        }
                    }, 75)
                );
            });
            return this;
        };
       </script>
       <script>
           (function () {
                var isPlay = true;
                
                $("#music").on("click",function(){
                    var audio = $('#audio_music')[0];
                    var that = $(this);
                    if (isPlay) {
                        audio.pause();
                        isPlay = false;
                        that.removeClass('on');
                    }
                    else {
                        audio.play();
                        isPlay = true;
                        that.addClass('on');
                    }
                });
            })();
       </script>
       
       <script>
           if (GetQueryString('from') === 'edit') {
               $('.share').show();
           }
           
            $('.link').click(function () {
                if (GetQueryString('from') === 'edit') {
                    location.href = 'wx.html';
                } else {
                    $('.code').show();
                }
            });
            $('.mask').click(function () {
                $(this).hide();
            });
       </script>
       <script src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
       <script>
            $.post('/Wxchat.php', {
                url: encodeURIComponent(location.href.split('#')[0])
            }, function (data) {
                data = JSON.parse(data);
                
                wx.config({
                    debug: false,
                    appId: data.appId, // 必填，公众号的唯一标识
                    timestamp: data.timestamp, // 必填，生成签名的时间戳
                    nonceStr: data.nonceStr, // 必填，生成签名的随机串
                    signature: data.signature,// 必填，签名
                    jsApiList: [
                        "onMenuShareTimeline",
                        "onMenuShareAppMessage",
                        "onMenuShareQQ",
                        "onMenuShareWeibo",
                        "onMenuShareQZone"
                    ] // 必填，需要使用的JS接口列表
                });
                
                

                wx.ready(function(){
                    $('#audio_music')[0].play();
                    
                    var customer = GetQueryString('customer');
                    var username = GetQueryString('username');
                    var customerJob = GetQueryString('customerJob');

                     var config = {
                        title: '尊敬的' + customer + customerJob + '，' + username + '给您拜年了！',
                        desc: '因为你，我的人生从此不同',
                        link: location.href.replace('edit', ''),
                        imgUrl: 'http://h5.we-going.com/images/p4.jpg',
                        success: function () { 
                        },
                        cancel: function () { 
                        }
                    };/*分享给朋友*/
                    wx.onMenuShareAppMessage(config);
                    
                    /*分享到QQ*/
                    wx.onMenuShareQQ(config);
                    
                    /*分享到腾讯微博*/
                    wx.onMenuShareWeibo(config);
                    
                    /*分享到QQ空间*/
                    wx.onMenuShareQZone(config);
                    
        　　　　　　  wx.onMenuShareTimeline(config);
                });
            });
       </script>
   </body>
</html>