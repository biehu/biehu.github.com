<!DOCTYPE html>
<html>
   <head>
       <meta charset="utf-8" />
       <meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport">
       <title>Untitled Document</title>
       <style>
           * {
               margin: 0;
               padding: 0;
           }
            .snow {
              position: absolute;
              top: 0;
              left: 0;
              z-index: 20;
              opacity: .8;
            }
            .load {
                width: 100%;
                position:absolute;
                top: 50%; 
                text-align: center;
                font-size: 40px;
            }
            
            body {
                overflow: hidden;
            }
            .wrap {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                -webkit-transition: all 0.3s linear;
                -webkit-backface-visibility: hidden;
            }
            
            section {
                overflow: hidden;
                position: relative;
                width: 100%;
            }
            section img {
                display: block;
            }
            .typed {
                position: absolute;
                top: 195px;
                right: 0;
                width: 442px;
                height: 230px;
                background: url(./images/text-bg.png) no-repeat;
                background-size: cover;
                font-size: 24px;
                box-sizing: border-box;
                padding: 40px;
                line-height: 1.5;
                
            }
            .typed1 {
                width: 465px;
                height: 264px;
                background: url(./images/text-bg2.png) no-repeat;
                background-size: cover;
            }
            .typed-cursor {
                display: none;
            }
            
            /*
             * p1
             */
            
            .p1-r {
                position: absolute;
                left: 100%;
                top: 0;
                transition: .5s;
            }
            .show .p1-r {
                left: 0;
            }
            
            /*
             * p2
             */
            
            .section2 .typed {
                top: 390px;
                padding: 54px;
            }
            .section2 .p2-r {
                position: absolute;
                left: 0;
                top: 0;
                transition: .5s;
                transition-delay: .5s;
                opacity: 0;
            }
            .show .p2-r {
                opacity: 1;
            }
            
            /*
             * p3
             */
            
            .section3 .typed1 {
                top: 50px;
                width: 524px;
                height: 297px;
                padding: 63px;
            }
            .section3 .p3-r {
                position: absolute;
                top: 0;
                left: 0;
                animation: bounce-up 1s linear infinite;
            }
            @keyframes bounce-up {
                25% {transform: translateY(10px);}
                50%, 100% {transform: translateY(0);}
                75% {transform: translateY(-10px);}
            }
            
            /*
             * p4
             */
            
            .section4 .p4-r {
                position: absolute;
                left: 170px;
                top: 20px;
                width: 90px;
                height: 90px;
                border-radius: 50%;
                overflow: hidden;
                background: #c1132a;
            }
            .section4 .typed {
                background: none;
                top: 78px;
                left: 0;
                right: auto;
                width: 72%;
                font-size: 24px;
                line-height: 2;
                color: #000;
                text-align: center;
            }
            .section4 .p4-h {
                position: absolute;
                left: 0;
                top: 0;
                animation: bounce-left 1s linear infinite;
                transform-origin: 312px 911px;
            }
            @keyframes bounce-left {
                25% {transform: rotate(10deg);}
                50%, 100% {transform: rotate(0);}
                75% {transform: rotate(-10deg);}
            }
            .section4 a {
                color: #5b2705;
                position: absolute;
                width: 100%;
                line-height: 30px;
                font-size:24px;
                text-align: center;
                top: 100%;
                margin-top: -60px;
                text-decoration: none;
            }
            
            
       </style>
       <script type="text/javascript">
            function viewport(){ var phoneWidth = parseInt(window.screen.width); var phoneScale = phoneWidth / 640; var ua = navigator.userAgent; if (/Android (\d+\.\d+)/.test(ua)) { var version = parseFloat(RegExp.$1); if (ua.toLowerCase().indexOf("qq") > -1) { document.write('<meta name="viewport" content="width=640, minimum-scale = ' + phoneScale + ', maximum-scale = ' + phoneScale + ', target-densitydpi=320">'); return; } if (version > 2.3) { document.write('<meta name="viewport" content="width=640, minimum-scale = ' + phoneScale + ', maximum-scale = ' + phoneScale + ', target-densitydpi=device-dpi">'); } else { document.write('<meta name="viewport" content="width=640, target-densitydpi=device-dpi">'); } } else { document.write('<meta name="viewport" content="width=640, user-scalable=no, target-densitydpi=device-dpi">'); } }  viewport();
        </script>
   </head>
   <body>
       
       <div class="load">
           正在加载中...
           
       </div>
       
       <div class="all" style="display: none;">
           <canvas class="snow" id="snow" width="100%" height="100%"></canvas>
           <div class="wrap">
               <section class="section1">
                   <p class="typed">
                   </p>
                   <img src="./images/w/bg.jpg"/>
                   <img class="p1-r" src="./images/w/p1.png"/>
               </section>
               <section class="section2">
                   <p class="typed">
                   </p>
                   <img src="./images/w/p2-bg.jpg"/>
                   <img class="p2-r" src="./images/w/p2.png"/>
               </section>
               <section class="section3">
                   <p class="typed typed1">
                   </p>
                   <img src="./images/w/p3-bg.jpg"/>
                   <img class="p3-r" src="./images/p3-r.png"/>
               </section>
               <section class="section4">
                   <img class="p4-r" src="" />
                   <p class="typed typed2">
                   </p>
                   <img src="./images/w/p4.jpg"/>
                   <img class="p4-h" src="./images/w/p4.png"/>
                   <a href="">点击右边按钮生成自己的专属拜年贺卡吧</a>
               </section>
           </div>
       
       </div>
       <script src="scripts/jquery.js"></script>
        <script src="scripts/typed.js"></script>
        
        
        <script> 
        (function () {
            var pics = [
                "http://biehu.me/test/new_year_2018/images/text_bg.png",
                "http://biehu.me/test/new_year_2018/images/w/p2-bg.jpg",
                "http://biehu.me/test/new_year_2018/images/w/p2.png",
                "http://biehu.me/test/new_year_2018/images/w/p3-bg.jpg",
                "http://biehu.me/test/new_year_2018/images/p3-r.png",
                "http://biehu.me/test/new_year_2018/images/w/p4.png",
                "http://biehu.me/test/new_year_2018/images/w/p4.jpg",
            ];
            var index = 0;
            var len = pics.length;
            
            var progress = function (w) {
                $('.loading').animate({width: w}, 100, 'linear', function () {
                    $('.loading-text').text(w);
                });
            };
            
            var loaded = function () {
                 $('.all').show();
                 $('.load').hide();
                 
                 
                 makeSnow(canvas);
                 page();
            };
            
            var load = function () {
                var img = new Image();
                img.src = pics[index];
                img.onload = function () {
                    progress(Math.floor((index + 1) / len * 100) + '%');
                    index += 1;
                    if (index < len) {
                        load();
                    }
                    else {
                        loaded();
                    }
                };
            };
            
            var init = function () {
                if (len > 0) {
                    load();
                }
                else {
                    progress('100%');
                }
            };
            
            init();

        })();
       </script>

       <script>
           
           var canvas = document.getElementById('snow');
    
    function makeSnow(el) {
        var ctx = el.getContext('2d');
        var width = 0;
        var height = 0;
        var particles = [];
        
        var Particle = function() {
            this.x = this.y = this.dx = this.dy = 0;
            this.reset();
        }
        
        Particle.prototype.reset = function() {
            this.y = Math.random() * height;
            this.x = Math.random() * width;
            this.dx = (Math.random() * 1) - 0.5;
            this.dy = (Math.random() * 0.5) + 0.5;
        }
        
        function createParticles(count) {
            if (count != particles.length) {
                particles = [];
                for (var i = 0; i < count; i++) {
                    particles.push(new Particle());
                }
            }
        }
                
        function onResize() {
            width = window.innerWidth;
            height = window.innerHeight;
            el.width = width;
            el.height = height;
            
            createParticles((width * height) / 10000);
        }
        
        function updateParticles() {
            ctx.clearRect(0, 0, width, height);
            ctx.fillStyle = '#f6f9fa';
            
            particles.forEach(function(particle) {
                particle.y += particle.dy;
                particle.x += particle.dx;
                
                if (particle.y > height) {
                    particle.y = 0;
                }
                
                if (particle.x > width) {
                    particle.reset();
                    particle.y = 0;
                }
                
                ctx.beginPath();
                ctx.arc(particle.x, particle.y, 5, 0, Math.PI * 2, false);
                ctx.fill();
            });
            
            window.requestAnimationFrame(updateParticles);
        }
        
        onResize();
        updateParticles();
    }
    
       </script>
       
       
       <script>
        function page() {
            var root = $('.wrap');
            var section = root.find('section');
            var movePrevent = false;
            var touchDown = false;
            var curPage = 0;
            var pageHeight, startX, startY, margin;
            
            var config = [
                ' 尊敬的xxx<br/>过年好!<br/>新的一年，让我们重新认识一下！',
                '曾经，我是那村里的二狗子，每天无所事事，只想吃饭睡觉。直到我遇见您......',
                '在您如春风般的温暖下，如夏  日般的照耀下，现在，我是团队中的业  务骨干，每每能轻松拿下销冠，  华丽转身，成了城里的Marry，似乎走在了时尚潮流的最前端！',
                'XXX（销售名）在这里给您拜年啦<br/>\
我的感恩化作深深的祝福：<br/>\
祝您狗年大吉事事顺，<br/>\
大展宏图日日新，<br/>\
全家团圆人人康，<br/>\
我会继续努力，提供最好的服务，<br/>\
一定为您的企业创造更高价值！'
            
            
            ];
            
            var bind = function () {
                document.body.addEventListener('touchstart', function (e) {
                    onStart(e.changedTouches[0]);
                });
                
                document.body.addEventListener('touchmove', function (e) {
                    e.preventDefault();
                    onMove(e.changedTouches[0]);
                });
                
                document.body.addEventListener('touchend', function (e) {
                    onEnd(e.changedTouches[0]);
                });
            };
            
            var prevPage = function () {
                animatePage(curPage - 1);
            };
            
            var nextPage = function () {
                animatePage(curPage + 1);
            };
            
            var setTop = function (pos) {
                root.css({'-webkit-transform': 'matrix(1, 0, 0, 1, 0,' + pos + ')'});
            };
            
            var onStart = function (e) {
                if (movePrevent) {
                    return;
                }
                
                touchDown = true;
                
                startX = e.pageX;
                startY = e.pageY;
                margin = root.css('-webkit-transform');
                margin = margin.replace("matrix(", "");
                margin = margin.replace(")", "");
                margin = margin.split(",");
                margin = parseInt(margin[5]);
            };
            
            var onMove = function (e) {
                if (movePrevent || !touchDown) {
                    return;
                }
                
                if (e.pageY !== startY) {
                    setTop(margin + e.pageY - startY);
                }
            };
            
            var onEnd = function (e) {
                if (movePrevent) {
                    return;
                }
                
                var endY = e.pageY;
                
                touchDown = false;
                
                if (Math.abs(endY - startY) < 50) {
                    animatePage(curPage);
                }
                else if (endY > startY) {
                    prevPage();
                }
                else {
                    nextPage();
                }
                
            };
            
            var animatePage = function (newPage) {
                var newMarginTop;
                
                if (newPage < 0) {
                    newPage = 0;
                }
                if (newPage > section.length - 1) {
                    newPage = section.length - 1;
                }
                
                curPage = newPage;
                
                movePrevent = true;
                root.one('webkitTransitionEnd', function () {
                    movePrevent = false;
                });
                newMarginTop  = newPage * (-pageHeight);
                setTop(newMarginTop);
                
                section.removeClass('show');
                section.eq(curPage).addClass('show');
                section.eq(curPage).find(".typed").typed({
                    strings: [config[curPage]],
                    typeSpeed: 30,
                    backDelay: 500,
                    loop: false,
                    contentType: 'html', // or text
                    // defaults to false for infinite loop
                    loopCount: false,
                    callback: function(){ },
                    resetCallback: function() {  }
                });
                
                if (curPage > 1) {
                    $('.snow').hide();
                } else {
                    $('.snow').show();
                }
            };
            
            var pageInit = function () {
                pageHeight = $(window).height();
                
                section.height(pageHeight);
                animatePage(curPage);
                
                bind();
            };
            
            pageInit();
    

        };
       </script>
   </body>
</html>