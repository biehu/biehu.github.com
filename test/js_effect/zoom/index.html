<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Magnifier</title>
<style type="text/css">
#magnifier{
 width:342px;
 height:420px;
 position:absolute;
 top:100px;
 left:250px;
 font-size:0;
 border:1px solid #000;
}
#img{
 width:342px;
 height:420px;
}
#Browser{
 border:1px solid #000;
 z-index:100;
 position:absolute;
 background:#555;
}
#mag{
 border:1px solid #000;
 overflow:hidden;
 z-index:100;
}
</style>
</head>
<body>
<div id="magnifier">
<img src="images/03.jpg" id="img" />
<div id="Browser"></div>
</div>
<div id="mag"><img id="magnifierImg" /></div>
<select style="position:absolute;top:200px;left:650px;width:100px;">
<option>select测试</option>
<option>是否能覆盖</option>
</select>

<script type="text/javascript">
//兼容浏览器的鼠标x,y获得函数
function getPointerPosition(ev) {   
 var e = ev || window.event;
 var x = e.pageX || (e.clientX + (document.documentElement.scrollLeft || document.body.scrollLeft));
 var y = e.pageY || (e.clientY + (document.documentElement.scrollTop || document.body.scrollTop));
 return { 'x':x,'y':y };
}

//兼容浏览器设置透明值
function setOpacity(elem,level) {   
 if(elem.filters) {
  elem.style.filter = 'alpha(opacity=' + level * 100 + ')';
 } else {
  elem.style.opacity = level;
 }
}

//css设置函数,可以方便设置css值,并且兼容设置透明值
function css(elem,prop) {    
 for(var i in prop) {
  if(i == 'opacity') {
   setOpacity(elem,prop[i]);
  } else {
   elem.style[i] = prop[i];
  }
 }
 return elem;
}


var magnifier = {
 m : null,
 
 init:function(magni){
  var m = this.m = magni || {
   cont : null,  //装载原始图像的div
   img : null,   //放大的图像
   mag : null,   //放大框
   scale : 15   //比例值
  }
  
  //设置放大图的样式
  css(m.img,{ 
   'position' : 'absolute',
   'width' : (m.cont.clientWidth * m.scale) + 'px',   
   'height' : (m.cont.clientHeight * m.scale) + 'px'
   })
  
  //设置放大图容器的样式
  css(m.mag,{
   'display' : 'none',
   'width' : m.cont.clientWidth + 'px',  
   'height' : m.cont.clientHeight + 'px',
   'position' : 'absolute',
   'left' : m.cont.offsetLeft + m.cont.offsetWidth + 10 + 'px',  //放大框的位置为原始图像的右方远10px
   'top' : m.cont.offsetTop + 'px'
   })
  
  var borderWid = m.cont.getElementsByTagName('div')[0].offsetWidth - m.cont.getElementsByTagName('div')[0].clientWidth;  //获取border的宽
  
  //设置原始图上选择框样式
  css(m.cont.getElementsByTagName('div')[0],{ 
   'display' : 'none',      
   'width' : m.cont.clientWidth / m.scale - borderWid + 'px',   
   'height' : m.cont.clientHeight / m.scale - borderWid + 'px', 
   'opacity' : 0.5   
   })
  
  m.img.src = m.cont.getElementsByTagName('img')[0].src; 
  m.cont.style.cursor = 'crosshair';
  
  m.cont.onmouseover = magnifier.start;
  
 },
 
 start:function(e){
  var isIE = !!window.ActiveXObject;
  var isIE6 = isIE && !window.XMLHttpRequest;
  if(isIE6){ //避免IE6的select无法覆盖
   magnifier.createIframe(magnifier.m.img);
  }
  
  this.onmousemove = magnifier.move;  //this指向m.cont
  this.onmouseout = magnifier.end;
 },
 
 move:function(e){
  var pos = getPointerPosition(e);  //事件标准化
  
  var magArea=this.getElementsByTagName('div')[0];
  magArea.style.display = '';

  css(this.getElementsByTagName('div')[0],{
   'top' : Math.min(Math.max(pos.y - this.offsetTop - parseInt(magArea.style.height)/2,0),this.clientHeight - magArea.offsetHeight)+'px',
   'left' : Math.min(Math.max(pos.x - this.offsetLeft - parseInt(magArea.style.width)/2,0),this.clientWidth - magArea.offsetWidth)+'px'		//left=鼠标x - this.offsetLeft - 浏览框宽/2,Math.max和Math.min让浏览框不会超出图像
   })
  
  magnifier.m.mag.style.display ='';
  
  css(magnifier.m.img,{
   'top' : - (parseInt(magArea.style.top) * magnifier.m.scale) + 'px',
   'left' : - (parseInt(magArea.style.left) * magnifier.m.scale) + 'px'
   })
  
 },
 
 end:function(e){
  this.getElementsByTagName('div')[0].style.display = 'none';
  magnifier.removeIframe(magnifier.m.img);  //销毁iframe
  
  magnifier.m.mag.style.display = 'none';
 },
 
 createIframe:function(elem){
  var layer = document.createElement('iframe');
  layer.tabIndex = '-1';
  layer.src = 'javascript:false;';
  elem.parentNode.appendChild(layer);
  
  layer.style.width = elem.offsetWidth + 'px';
  layer.style.height = elem.offsetHeight + 'px';
 },
 
 removeIframe:function(elem){
  var layers = elem.parentNode.getElementsByTagName('iframe');
  while(layers.length >0){
   layers[0].parentNode.removeChild(layers[0]);
  }
 }
}
 magnifier.init({
       cont : document.getElementById('magnifier'),
       img : document.getElementById('magnifierImg'),
       mag : document.getElementById('mag'),
       scale : 3
});

</script>
</body>
</html>