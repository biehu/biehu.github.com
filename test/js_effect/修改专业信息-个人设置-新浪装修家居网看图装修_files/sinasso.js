(function(){HouseSSOController=function(c){var b=this;this.name="sso_house_"+(+new Date);this.entry="supports_house";this.errorId="error";this.sinassourl="http://i.sso.sina.com.cn/js/ssologin.js";this.isSina=document.domain.indexOf("sina.com")>=0;this.popUp=false;this.loginFun="";this.auto=true;this.site="";this.timeout=2000;this.verifyHtmlId="verify_html";this.verifyInputId="verify_input";this.verifyImgId="verify_img";this.verifyurl="";this.custom={};this.notify=false;this.cookieUrls={leju:["http://baidu.my.leju.com/api/cookie/setcookie.php?callback=?&cookies=","http://house.baidu.com/user/setcookie.php?callback=?&cookies="],jiaju:["http://www.jiaju.com/Sso/Setcookie/?cookies="],eju:["http://sh.esf.eju.com/commajax.php?f=74&cookies="]};this.custom.login=function(e){if(e){if(document.getElementById("returnurl")){var f=document.getElementById("returnurl").value;if(f){window.location.href=f}}var d=(typeof b.loginFun=="function")?b.loginFun:window[b.loginFun];d&&d.call(this,e)}};this.custom.fail=function(d){if(d.errno==4049){if(location.href.indexOf("house.sina.com.cn")>=0||location.href.indexOf("jiaju.sina.com.cn")>=0){b.verifyurl="http://i.house.sina.com.cn/index.php?ctrl=login"}if(document.getElementById(b.verifyInputId)&&document.getElementById(b.verifyImgId)){b.updateDoor()}else{if(b.verifyurl!=""){var h=location.href;var g=b.verifyurl;if(g.indexOf("?")<0){g+="?"}g+="&isverify=1";location.href=g+"&returnurl="+encodeURIComponent(h);return false}}}else{if(document.getElementById(b.verifyInputId)){var e=document.getElementById(b.verifyInputId);if(e.value!=""){b.updateDoor()}}}if(b.popUp){alert(d.reason)}else{var f=document.getElementById(b.errorId);if(f){f.innerHTML=d.reason;f.style.display=""}}};this.paramArr="popUp,errorId,loginFun,site,auto,custom,timeout,verifyHtmlId,verifyInputId,verifyImgId,verifyurl,notify";for(var a in c){if(this.paramArr.indexOf(a)>=0){this[a]=c[a]}}this.init()};HouseSSOController.prototype={init:function(){var a=this;this.loadScript(a.sinassourl,function(){var b=new SSOController();window[a.name]=b;b.init();b.name=a.name;b.entry=a.entry;b.domain="sina.com.cn";b.setDomain=false;b.customLoginCallBack=function(d){a.loginCallBack(d,a.popUp)};b.customLogoutCallBack=function(d){a.logoutCallBack(d)};if(a.custom){a.custom.houseSSOController=a;a.custom.sinaSSOController=b;a.custom.init&&a.custom.init(a,b);if(a.notify){!HouseSSOController.notifies&&(HouseSSOController.notifies=[]);HouseSSOController.notifies.push(a.custom)}}if(a.auto){b.autoLogin(function(d){a.autoLogin(d)})}if(a.getQueryString(location.search).isverify==1){a.updateDoor();if(document.getElementById(a.errorId)){var c=document.getElementById(a.errorId);c.innerHTML="\u4e3a\u4e86\u60a8\u7684\u5e10\u53f7\u5b89\u5168\uff0c\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801";c.style.display=""}}})},autoLogin:function(a){var c="autoLogin";if(!this.getCookie("LUP")){if(a&&this.isSina){this.setSiteCookie(a,false,c)}else{if(!this.isSina){var b=this;this.loadScript("http://i.house.sina.com.cn/sso/get_cookie.php?callback=?",function(d){a=d.data||null;if(d.result){b.setSiteCookie(a,false,c)}else{b.customCallback(c,a)}})}else{if(!a){this.customCallback(c,a)}}}}else{this.customCallback(c,a)}},loginCallBack:function(b,a){var c=this;if(b.result){this.setSiteCookie(b.userinfo,true)}else{if(this.custom&&this.custom.fail){this.custom.fail(b);return false}}},logoutCallBack:function(a){this.customCallback("logout",a)},getCookie:function(a){var b,c;b=document.cookie.indexOf(a+"=");if(b==-1){return""}b+=a.length+1;c=document.cookie.indexOf(";",b);if(c==-1){c=document.cookie.length}return document.cookie.substring(b,c)},getQueryString:function(d){d=d.replace(/%3D/ig,"=");d=d.replace(/%26/g,"&");d=d.replace(/%25/g,"%");var b={},c=/([^&=]+)=([^&]*)/g,a;while(a=c.exec(d)){try{b[decodeURIComponent(a[1])]=decodeURIComponent(a[2])}catch(f){}}return b},loadScript:function(c,e,d){var b=document.createElement("script");b.type="text/javascript";if(/[&?]callback=?/.test(c)){if(typeof e=="function"){var a="_"+(+new Date)+Math.round(Math.random()*1000);window[a]=e;e=null;c=c.replace(/([&?]callback=)(\?)/,"$1"+a)}}if(d){b.timer=window.setTimeout(function(){if(a){window[a].call(this);if(a&&b.loaded){if(b.readyState){window[a]=null}else{delete (window[a])}}else{window[a]=function(){}}}if(e){if(typeof e=="function"){e.call(this)}e&&(e=null)}},d)}if(b.readyState){b.onreadystatechange=function(){if(b.readyState=="complete"||b.readyState=="loaded"){b.onreadystatechange=null;if(typeof e=="function"){e.call(this)}b.parentNode.removeChild(b);if(b.readyState=="loaded"){b.loaded=true;if(b.timer){(a&&window[a].call(this))}}else{b.timer&&window.clearTimeout(b.timer);a&&(window[a]==null)}}}}else{b.onload=function(){if(typeof e=="function"){e.call(this)}b.parentNode.removeChild(b);a&&delete (window[a]);b.timer&&window.clearTimeout(b.timer)};b.onerror=function(){b.parentNode.removeChild(b);b.loaded=true}}b.src=c;document.getElementsByTagName("head")[0].appendChild(b)},login:function(b,d,c){if(document.getElementById(this.verifyInputId)){var a=document.getElementById(this.verifyInputId).value;if(a){this.setDoor(a)}}var b=b||document.getElementById("username").value;var d=d||document.getElementById("password").value;window[this.name].login(b,d,c)},logout:function(){window[this.name].logout();this.deleteSiteCookie()},getDoor:function(){return window[this.name].getPinCodeUrl()},updateDoor:function(){var a=this;if(document.getElementById(a.verifyImgId)){var b=document.getElementById(a.verifyImgId);b.src=a.getDoor();b.style.cursor="pointer";b.onclick=function(){this.src=a.getDoor()};document.getElementById(a.verifyHtmlId).style.display="";document.getElementById(a.verifyInputId).value="";document.getElementById(a.verifyInputId).focus()}},setDoor:function(a){window[this.name].loginExtraQuery.door=a},setSiteCookie:function(e,a,h){var h=h||"login";if(!e||!(e.uid||e.uniqueid)){this.customCallback(h,e);return false}var d=e.uid||e.uniqueid;var f=this;var g=[];for(var c in f.cookieUrls){var b=f.cookieUrls[c];if((new RegExp(","+c+",")).test(","+f.site+",")){g=b.concat(g)}}this.loadScript("http://i.house.sina.com.cn/sso/cookies.php?callback=?&uid="+d,function(n){if(n.result=="succ"){var m=1;var l=g.length;if(a){l=l+1}if(!l){f.customCallback(h,e)}for(var k in g){if(g[k]==""){continue}f.loadScript(g[k]+n.cookies,function(){if(m==l){f.customCallback(h,e)}else{m++}},f.timeout)}if(a){var j=e.name||e.loginname||"";f.loadScript("http://i.house.sina.com.cn/index.php?ctrl=login&act=add_log&username="+j+"&uid="+d,function(){if(m==l){f.customCallback(h,e)}else{m++}},f.timeout)}}})},deleteSiteCookie:function(){this.loadScript("http://i.house.sina.com.cn/sso/logout.php?t="+parseInt(Math.random()*100));this.loadScript("http://house.baidu.com/user/cleancookie.php");this.loadScript("http://baidu.my.leju.com/api/cookie/cleancookie.php");this.loadScript("http://www.jiaju.com/Sso/Out");this.loadScript("http://sh.esf.eju.com/commajax.php?f=75")},customCallback:function(f,d){var c=this.getQueryString(this.getCookie("LUP"));for(var a in c){}if(!a){c=null}for(var b in d){}if(!b){d=null}d=c||d;var e=(f=="autoLogin")?"login":f;if(e&&this.custom&&this.custom[e]){this.custom[e](d);if(f==e){this.customNotify(e,d)}return false}},customNotify:function(e,d){var b=HouseSSOController.notifies;if(b){for(var a in b){var c=b[a];if(c){if(c.houseSSOController.name==this.name){continue}c[e]&&c[e](d)}}}}}})();