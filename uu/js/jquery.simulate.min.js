!function(b, h) {
    var n = /^key/
        , o = /^(?:mouse|contextmenu)|click/;
    b.fn.simulate = function(e, t) {
        return this.each(function() {
            new b.simulate(this,e,t)
        })
    }
        ,
        b.simulate = function(e, t, n) {
            var o = b.camelCase("simulate-" + t);
            this.target = e,
                this.options = n,
                this[o] ? this[o]() : this.simulateEvent(e, t, n)
        }
        ,
        b.extend(b.simulate, {
            keyCode: {
                BACKSPACE: 8,
                COMMA: 188,
                DELETE: 46,
                DOWN: 40,
                END: 35,
                ENTER: 13,
                ESCAPE: 27,
                HOME: 36,
                LEFT: 37,
                NUMPAD_ADD: 107,
                NUMPAD_DECIMAL: 110,
                NUMPAD_DIVIDE: 111,
                NUMPAD_ENTER: 108,
                NUMPAD_MULTIPLY: 106,
                NUMPAD_SUBTRACT: 109,
                PAGE_DOWN: 34,
                PAGE_UP: 33,
                PERIOD: 190,
                RIGHT: 39,
                SPACE: 32,
                TAB: 9,
                UP: 38
            },
            buttonCode: {
                LEFT: 0,
                MIDDLE: 1,
                RIGHT: 2
            }
        }),
        b.extend(b.simulate.prototype, {
            simulateEvent: function(e, t, n) {
                var o = this.createEvent(t, n);
                this.dispatchEvent(e, t, o, n)
            },
            createEvent: function(e, t) {
                return n.test(e) ? this.keyEvent(e, t) : o.test(e) ? this.mouseEvent(e, t) : void 0
            },
            mouseEvent: function(e, t) {
                var n, o, c, i;
                return t = b.extend({
                    bubbles: !0,
                    cancelable: "mousemove" !== e,
                    view: window,
                    detail: 0,
                    screenX: 0,
                    screenY: 0,
                    clientX: 1,
                    clientY: 1,
                    ctrlKey: !1,
                    altKey: !1,
                    shiftKey: !1,
                    metaKey: !1,
                    button: 0,
                    relatedTarget: h
                }, t),
                    document.createEvent ? ((n = document.createEvent("MouseEvents")).initMouseEvent(e, t.bubbles, t.cancelable, t.view, t.detail, t.screenX, t.screenY, t.clientX, t.clientY, t.ctrlKey, t.altKey, t.shiftKey, t.metaKey, t.button, t.relatedTarget || document.body.parentNode),
                    0 === n.pageX && 0 === n.pageY && Object.defineProperty && (o = n.relatedTarget.ownerDocument || document,
                        c = o.documentElement,
                        i = o.body,
                        Object.defineProperty(n, "pageX", {
                            get: function() {
                                return t.clientX + (c && c.scrollLeft || i && i.scrollLeft || 0) - (c && c.clientLeft || i && i.clientLeft || 0)
                            }
                        }),
                        Object.defineProperty(n, "pageY", {
                            get: function() {
                                return t.clientY + (c && c.scrollTop || i && i.scrollTop || 0) - (c && c.clientTop || i && i.clientTop || 0)
                            }
                        }))) : document.createEventObject && (n = document.createEventObject(),
                        b.extend(n, t),
                        n.button = {
                            0: 1,
                            1: 4,
                            2: 2
                        }[n.button] || (-1 === n.button ? 0 : n.button)),
                    n
            },
            keyEvent: function(t, n) {
                var o;
                if (n = b.extend({
                    bubbles: !0,
                    cancelable: !0,
                    view: window,
                    ctrlKey: !1,
                    altKey: !1,
                    shiftKey: !1,
                    metaKey: !1,
                    keyCode: 0,
                    charCode: h
                }, n),
                    document.createEvent)
                    try {
                        (o = document.createEvent("KeyEvents")).initKeyEvent(t, n.bubbles, n.cancelable, n.view, n.ctrlKey, n.altKey, n.shiftKey, n.metaKey, n.keyCode, n.charCode)
                    } catch (e) {
                        (o = document.createEvent("Events")).initEvent(t, n.bubbles, n.cancelable),
                            b.extend(o, {
                                view: n.view,
                                ctrlKey: n.ctrlKey,
                                altKey: n.altKey,
                                shiftKey: n.shiftKey,
                                metaKey: n.metaKey,
                                keyCode: n.keyCode,
                                charCode: n.charCode,
                                key: n.key
                            })
                    }
                else
                    document.createEventObject && (o = document.createEventObject(),
                        b.extend(o, n));
                return (/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()) || "[object Opera]" === {}.toString.call(window.opera)) && (o.keyCode = 0 < n.charCode ? n.charCode : n.keyCode,
                    o.charCode = h),
                    o
            },
            dispatchEvent: function(e, t, n) {
                e.dispatchEvent ? e.dispatchEvent(n) : "click" === t && e.click && "input" === e.nodeName.toLowerCase() ? e.click() : e.fireEvent && e.fireEvent("on" + t, n)
            },
            simulateFocus: function() {
                var e, t = !1, n = b(this.target);
                function o() {
                    t = !0
                }
                n.bind("focus", o),
                    n[0].focus(),
                t || ((e = b.Event("focusin")).preventDefault(),
                    n.trigger(e),
                    n.triggerHandler("focus")),
                    n.unbind("focus", o)
            },
            simulateBlur: function() {
                var e, t = !1, n = b(this.target);
                function o() {
                    t = !0
                }
                n.bind("blur", o),
                    n[0].blur(),
                    setTimeout(function() {
                        n[0].ownerDocument.activeElement === n[0] && n[0].ownerDocument.body.focus(),
                        t || ((e = b.Event("focusout")).preventDefault(),
                            n.trigger(e),
                            n.triggerHandler("blur")),
                            n.unbind("blur", o)
                    }, 1)
            }
        }),
        b.extend(b.simulate.prototype, {
            simulateDrag: function() {
                var e, t, n, o, c, i, r = 0, a = this.target, u = a.ownerDocument, l = this.options, s = "corner" === l.handle ? (i = b((o = a).ownerDocument),
                    {
                        x: (c = (o = b(o)).offset()).left - i.scrollLeft(),
                        y: c.top - i.scrollTop()
                    }) : (n = b((e = a).ownerDocument),
                    {
                        x: (t = (e = b(e)).offset()).left + e.outerWidth() / 2 - n.scrollLeft(),
                        y: t.top + e.outerHeight() / 2 - n.scrollTop()
                    }), d = Math.floor(s.x), m = Math.floor(s.y), E = {
                    clientX: d,
                    clientY: m
                }, v = l.dx || (l.x !== h ? l.x - d : 0), f = l.dy || (l.y !== h ? l.y - m : 0), y = l.moves || 3;
                for (this.simulateEvent(a, "mousedown", E); r < y; r++)
                    d += v / y,
                        m += f / y,
                        E = {
                            clientX: Math.round(d),
                            clientY: Math.round(m)
                        },
                        this.simulateEvent(u, "mousemove", E);
                b.contains(u, a) ? (this.simulateEvent(a, "mouseup", E),
                    this.simulateEvent(a, "click", E)) : this.simulateEvent(u, "mouseup", E)
            }
        })
}(jQuery);
