
<!DOCTYPE html>
<html lang="en">
  <head>
    <title>HTMLifier</title>
    <meta charset="UTF-8">
    <meta name="description" content="Converts a Scratch project to HTML/JavaScript"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <!--
    <link rel="stylesheet" type="text/css" href="../../sheep3.css">
    <script src="../../sheep3.js" charset="utf-8"></script>
    -->
    <script src="./234_files/hacky-file-getter.js" charset="utf-8"></script>
    <style media="screen">
      :target {
        animation: flash 3s;
      }
      @keyframes flash {
        0% {
          background-color: rgba(255, 255, 0, 0.5);
        }
        100% {
          background-color: transparent;
        }
      }
      #load-no-minify {
        font-size: 1.2em;
        cursor: pointer;
      }
      
      body > * {
        visibility: hidden;
      }
      
      body ._upload {
        position: relative;  
            display: inline-block;  
            background: #D0EEFF;  
            border: 1px solid #99D3F5;  
            border-radius: 4px;  
            padding: 4px 12px;  
            overflow: hidden;  
            color: #1E88C7;  
            text-decoration: none;  
            text-indent: 0;  
            line-height: 20px; 
        
      }
      body ._upload_displaynone {
        height: 0;
        visibility: hidden;
      }
      /*
      body ._upload ._upload_input {  
            position: absolute;  
            font-size: 100px;  
            right: 0;  
            top: 0;  
            opacity: 0;  
        } 
        */
      body ._upload ,
      body ._upload_button ,
      body ._upload_log {
        visibility: visible;
      }
    </style>
  </head>
  <body>
    <script src="https://sheeptester.github.io/scratch-vm/vm.min.js"></script>
    <script src="https://sheeptester.github.io/words-go-here/htmlifier/hacky-file-getter.js" charset="utf-8"></script>
    <script src="https://sheeptester.github.io/words-go-here/htmlifier/download.js" charset="utf-8"></script>

    <h1 class="_upload_displaynone">Project HTMLifier</h1>
    <h3 class="_upload_displaynone"><em>Convert a Scratch project to HTML</em></h3>
    <p class="_upload_displaynone">This packages your Scratch project into a single HTML file that can run on its own in a web browser. The HTML file will be pretty big because it contains the entire Scratch engine (2.6 MB) and the costume and sound files used in the project. There is no direct translation between a Scratch block and a JavaScript equivalent because the two languages are fundamentally different, so you should not use the code in the generated file for learning HTML or JavaScript after Scratch.</p>
    <p class="_upload_displaynone">The project will automatically start, and there are no green flag or stop sign buttons.</p>
    <p class="_upload_displaynone"><label><input type="radio" name="upload-mode" value="id" checked> Project ID: <input type="number" placeholder="Project ID" value="284516654" id="id"> (the ID of the project on the Scratch website)</label></p>
    <p><label class="_upload">
      <input type="hidden" name="upload-name" value="项目">
      <input type="radio" name="upload-mode" value="file" class="_upload_displaynone"> 点击上传文件 <input class="_upload_input" type="file" id="file" accept=".sb,.sb2,.sb3"></label></p>
    <fieldset class="_upload_displaynone">
      <legend>Options</legend>
      <p><label for="title">Project name: </label><input type="text" placeholder="Project name" value="Zombie Cube Escape!" id="title"> (the text displayed in the browser tab)</p>
      <p><label for="username">Username value: </label><input type="text" placeholder="Username" value="griffpatch" id="username"> (the value that the username block reports)</p>
      <p><label><input type="checkbox" id="fullscreen" checked> Show fullscreen button?</label></p>
      <p><label><input type="checkbox" id="turbo"> Enable <a href="https://en.scratch-wiki.info/wiki/Turbo_Mode">turbo mode</a>?</label></p>
      <p><label><input type="checkbox" id="use-colour"> Use custom variable/list monitor colour: <input type="color" id="monitor-colour" value="#ff8c1a">? (If unchecked, a translucent black will be used.)</label></p>
      <p><label><input type="checkbox" id="progress" checked> Load progress indicator?</label></p>
      <p><label><input type="checkbox" id="compatibility" checked> Enable compatibility mode?<a id="ref-2" href="#note-2"><sup>2</sup></a></label></p>
      <p><label><input type="checkbox" id="wider"> Does this project use a <a href="https://sheeptester.github.io/scratch-gui/?width=640&height=360">custom size</a>?</label> <label>Width: <input type="number" value="640" id="width"></label> <label>Height: <input type="number" value="360" id="height"></label></p>
      <fieldset>
        <legend>Cloud variable source</legend>
        <p><label><input type="radio" name="cloud-provider" value="localstorage" checked> Save cloud variables locally using localStorage<a id="ref-1" href="#note-1"><sup>1</sup></a></label></p>
        <p><label><input type="radio" name="cloud-provider" value="ws"> Use a <a href="https://github.com/SheepTester/primitive-cloud-server">custom server</a>: <input type="url" id="cloud-ws" placeholder="ws://localhost:3000/"></label></p>
      </fieldset>
    </fieldset>
    <p>
      <button id="load-no-minify" class="_upload_button">转换</button>
    </p>
    <textarea  class="_upload_log" id="error" rows="8" cols="40" placeholder="Log" readonly></textarea>
    <p id="note-1"><a href="#ref-1"><sup>1</sup></a>You may have to deal with privacy laws around cookies outside of Scratch.</p>
    <p id="note-2"><a href="#ref-2"><sup>2</sup></a>Compatibility mode forces projects to run at 30 FPS, like in Scratch 2.0. Turning this off allows the project to run at a higher framerate (usually 60 FPS, depending on the computer screen's refresh rate).</p>
    <h2>Update history</h2>
    <h3>2019-12-25</h3>
    <ul>
      <li>An option to use a custom cloud server for cloud variables instead of saving to localStorage</li>
    </ul>
    <h3>2019-11-23</h3>
    <ul>
      <li>A fullscreen button</li>
      <li>An option to change monitor colours</li>
    </ul>
    <h3>2019-10-05</h3>
    <ul>
      <li>New ask box</li>
    </ul>
    <h3>2019-09-28</h3>
    <ul>
      <li>A status text that shows the assets loaded</li>
      <li>Support the video extension</li>
      <li>Support draggable sprites</li>
    </ul>
    <h3>2019-08-08</h3>
    <ul>
      <li>Removed "Scratch" from the name of this utility just in case</li>
    </ul>
    <h3>2019-07-27</h3>
    <ul>
      <li>Support 16:9 projects</li>
      <li>Simplify the number of modes for HTMLification</li>
    </ul>
    <h3>2019-07-13</h3>
    <ul>
      <li>Cloud variables store in localStorage</li>
    </ul>
    <h3>2019-06-29</h3>
    <ul>
      <li>Upload project file instead of using project ID</li>
      <li>Toggle compatibility and turbo mode</li>
    </ul>
    <h3>2019-03-31</h3>
    <ul>
      <li>Variable and list watchers</li>
    </ul>
    <h3>2019-02-09</h3>
    <ul>
      <li>Project start</li>
    </ul>
    <p>Made by <a href="https://scratch.mit.edu/users/Sheep_maker/">Sheep_maker</a>, who used <a href="https://github.com/LLK/scratch-vm/">scratch-vm</a>, <a href="http://danml.com/download.html">download.js</a>, and their dependencies for this project.</p>
    <script type="text/javascript">
const loadNoMinifyBtn = document.getElementById('load-no-minify');
const title = document.getElementById('title');
const id = document.getElementById('id');
const username = document.getElementById('username');
const file = document.getElementById('file');
const error = document.getElementById('error');
const compatibility = document.getElementById('compatibility');
const turbo = document.getElementById('turbo');
const wider = document.getElementById('wider');
const progressBar = document.getElementById('progress');
const fullscreen = document.getElementById('fullscreen');
const useColour = document.getElementById('use-colour');
const monitorColour = document.getElementById('monitor-colour');
const cloudServer = document.getElementById('cloud-ws');
const width = document.getElementById('width');
const height = document.getElementById('height');
function getProject() {
  if (document.querySelector('input[name="upload-mode"]:checked').value === 'file') {
    if (!file.files || !file.files[0]) return Promise.reject(new Error('No file selected'));
    return new Promise(res => {
      const reader = new FileReader();
      reader.onload = () => res({data: reader.result});
      reader.readAsDataURL(file.files[0]);
    });
  } else {
    return Promise.resolve({id: id.value});
  }
}
function load() {
  loadNoMinifyBtn.disabled = true;
  error.value = '';
  getProject()
    .then(src => downloadAsHTML(src, {
      title: title.value,
      username: username.value,
      log: output => {
        error.value += output + '\n';
        error.scrollTop = error.scrollHeight;
      },
      ratio16to9: wider.checked,
      progressBar: progressBar.checked,
      fullscreen: fullscreen.checked,
      monitorColour: useColour.checked ? monitorColour.value : null,
      cloudServer: document.querySelector('input[name="cloud-provider"]:checked').value === 'ws'
        ? cloudServer.value : null,
      projectId: id.value,
      width: wider.checked ? width.value : 480,
      height: wider.checked ? height.value : 360
    }))
    .then(html => {
      download(html, document.querySelector('input[name="upload-name"]').value + '.html', 'text/html');
      loadNoMinifyBtn.disabled = false;
    }).catch(err => {
      console.log(err);
      error.value = err.message;
      loadNoMinifyBtn.disabled = false;
    });
}
loadNoMinifyBtn.addEventListener('click', load);
file.addEventListener('change', e => {
  if (file.files[0]) {
    document.querySelector('input[name="upload-name"]').value = file.files[0].name;
    document.querySelector('input[name="upload-mode"][value="file"]').checked = true;
  }
});
width.addEventListener('change', e => {
  wider.checked = true;
});
height.addEventListener('change', e => {
  wider.checked = true;
});
monitorColour.addEventListener('change', e => {
  useColour.checked = true;
});
    </script>
  </body>
</html>
